<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Entretenimiento - Juegos Topografía</title>
   
  <script src="https://cdn.tailwindcss.com"></script>
  <style>

    
    /* estilos adicionales para selección de letras */
    .cell {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      cursor: pointer;
    }
    .cell.selected { background-color: rgba(253, 230, 138, 0.95); }
    .cell.found { background-color: rgba(34,197,94,0.9); color: white; font-weight: 700; }
    .cell.revealed { background-color: rgba(59,130,246,0.9); color: white; font-weight: 700; }
    .input-letter { width: 40px; height: 40px; text-align:center; font-weight:700; text-transform:uppercase;}
    /* crossword grid small cells */
    .cross-cell { width:40px; height:40px; border:1px solid rgba(255,255,255,0.08); }
    .cross-cell input { width:100%; height:100%; text-align:center; font-weight:700; text-transform:uppercase; background:transparent; border:none; color:inherit;}
    .cross-black { background:rgba(0,0,0,0.7); }
  </style>
</head>
<body 
 class="bg-green-900 text-gray-100">
  <div class="min-h-screen">
    <!-- NAV -->
    <header class="bg-green-800 shadow-lg">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="imagenes/logo.png" alt="Logo" class="w-12 h-12 rounded-full border-2 border-white">
          <h1 class="text-xl md:text-2xl font-extrabold text-yellow-300">Juegos Topografía</h1>
        </div>
        <nav class="space-x-4">
          <a href="#sopa" class="text-yellow-300 hover:underline">Sopa de letras</a>
          <a href="#crucigrama" class="text-yellow-300 hover:underline">Crucigrama</a>
          <a href="index.html" class="text-yellow-300 hover:underline">Inicio</a>
        </nav>
      </div>
      <p class="mt-3 text-gray-300 max-w-3xl">Diviértete y practica vocabulario topográfico. Encuentra las palabras en la sopa de letras o completa el crucigrama.</p>
    </header>

    <main class="max-w-6xl mx-auto px-4 pb-12 space-y-12">

      <!-- SOPA DE LETRAS -->
      <section id="sopa" class="bg-white/5 rounded-2xl p-6 relative overflow-hidden">
        <h2 class="text-2xl font-bold mb-4">Sopa de letras</h2>
        <p class="text-sm text-gray-300 mb-4">Selecciona letras (clic en las casillas) en orden para formar la palabra y presiona <b>Comprobar</b>. También puedes hacer clic en el primer y último para seleccionar múltiples letras.</p>

        <div class="md:flex md:gap-8">
          <!-- grid -->
          <div class="flex-1">
            <div id="grid" class="grid gap-1" style="grid-template-columns:repeat(12, 36px)"></div>
            <div class="mt-4 flex gap-3">
              <button id="checkBtn" class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg font-semibold hover:bg-yellow-300">Comprobar</button>
              <button id="resetBtn" class="bg-white/10 px-4 py-2 rounded-lg hover:bg-white/20">Reiniciar</button>
              <button id="revealBtn" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-500">Mostrar solución</button>
            </div>
            <p id="msg" class="mt-3 text-sm"></p>
          </div>

          <!-- lista de palabras -->
          <aside class="mt-6 md:mt-0 md:w-64">
            <div class="bg-white/3 rounded-lg p-4">
              <h3 class="font-semibold mb-2">Palabras a encontrar</h3>
              <ul id="wordsList" class="space-y-1 text-gray-200"></ul>
            </div>
          </aside>
        </div>
      </section>

      <!-- CRUCIGRAMA -->
      <section id="crucigrama" class="bg-white/5 rounded-2xl p-6">
        <h2 class="text-2xl font-bold mb-4">Crucigrama</h2>
        <p class="text-sm text-gray-300 mb-4">Completa el crucigrama con las palabras relacionadas a topografía. Presiona <b>Comprobar</b> o <b>Mostrar solución</b>.</p>

        <div class="md:flex md:gap-8">
          <!-- grid crucigrama -->
          <div class="bg-white/3 rounded-lg p-4">
            <div id="crossGrid" class="grid gap-0" style="grid-template-columns: repeat(9, 40px);"></div>
            <div class="mt-4 flex gap-3">
              <button id="crossCheck" class="bg-yellow-400 text-gray-900 px-4 py-2 rounded-lg font-semibold hover:bg-yellow-300">Comprobar</button>
              <button id="crossReveal" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-500">Mostrar solución</button>
              <button id="crossReset" class="bg-white/10 px-4 py-2 rounded-lg hover:bg-white/20">Reiniciar</button>
            </div>
            <p id="crossMsg" class="mt-3 text-sm"></p>
          </div>

          <!-- pistas -->
          <aside class="mt-6 md:mt-0 md:flex-1">
            <div class="bg-white/3 rounded-lg p-4">
              <h3 class="font-semibold mb-2">Pistas</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <h4 class="font-semibold">Horizontal</h4>
                  <ol class="pl-4 list-decimal text-gray-200">
                    <li><b>1.</b> Instrumento para medir ángulos (7 letras)</li>
                    <li><b>3.</b> Red de elementos subterráneos para agua (7 letras)</li>
                  </ol>
                </div>
                <div>
                  <h4 class="font-semibold">Vertical</h4>
                  <ol class="pl-4 list-decimal text-gray-200">
                    <li><b>2.</b> Línea que une puntos de igual altura (5 letras)</li>
                    <li><b>4.</b> Dispositivo que proporciona posición (3 letras)</li>
                  </ol>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </section>
    </main>

    <footer class="max-w-6xl mx-auto px-4 pb-10 text-sm text-gray-400">
      <p>© <span id="y"></span> Juegos Topografía. Practica y diviértete.</p>
    </footer>
  </div>

  <!-- LOGICA JS -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    /* ---------- SOPA DE LETRAS ---------- */
    // palabras (ES) relacionadas con topografía
    const WORDS = ['ESTACION', 'CURVA', 'ALCANTARILLADO', 'DRONE', 'GPS', 'COORDENADA', 'NIVEL', 'PROFUNDIDAD'];

    // Vamos a usar un grid 12x12
    const ROWS = 12, COLS = 12;
    let grid = Array.from({length: ROWS}, () => Array.from({length: COLS}, () => ''));

    // posiciones de palabras almacenadas {word, coords: [{r,c}, ...]}
    const placed = [];

    // función para poner palabra horizontal o vertical (intentar)
    function placeWord(word) {
      const maxAttempts = 200;
      const len = word.length;
      for (let attempt=0; attempt<maxAttempts; attempt++) {
        const dir = Math.random() < 0.5 ? 'H' : 'V';
        let r = Math.floor(Math.random()*ROWS);
        let c = Math.floor(Math.random()*COLS);
        if (dir === 'H') {
          if (c + len > COLS) continue;
          // check conflicts
          let ok = true;
          for (let i=0;i<len;i++) {
            const ch = grid[r][c+i];
            if (ch !== '' && ch !== word[i]) { ok = false; break; }
          }
          if (!ok) continue;
          // place
          const coords = [];
          for (let i=0;i<len;i++) { grid[r][c+i] = word[i]; coords.push({r,c:c+i}); }
          return coords;
        } else {
          if (r + len > ROWS) continue;
          let ok = true;
          for (let i=0;i<len;i++) {
            const ch = grid[r+i][c];
            if (ch !== '' && ch !== word[i]) { ok=false; break; }
          }
          if (!ok) continue;
          const coords = [];
          for (let i=0;i<len;i++) { grid[r+i][c] = word[i]; coords.push({r:i+r,c}); }
          return coords;
        }
      }
      return null;
    }

    // place all words (uppercase)
    const wordsToPlace = WORDS.map(w=>w.toUpperCase());
    for (const w of wordsToPlace) {
      const coords = placeWord(w);
      if (coords) placed.push({word:w, coords});
      else console.warn('No se pudo colocar:', w);
    }

    // fill remaining with random letters
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    for (let r=0;r<ROWS;r++){
      for (let c=0;c<COLS;c++){
        if (!grid[r][c] || grid[r][c]==='') grid[r][c] = letters[Math.floor(Math.random()*letters.length)];
      }
    }

    // render grid HTML
    const gridEl = document.getElementById('grid');
    const wordsListEl = document.getElementById('wordsList');
    let selection = []; // list of {r,c,el}
    let foundWords = new Set();

    function renderGrid(){
      gridEl.innerHTML = '';
      gridEl.style.gridTemplateColumns = `repeat(${COLS}, 36px)`;
      for (let r=0;r<ROWS;r++){
        for (let c=0;c<COLS;c++){
          const span = document.createElement('div');
          span.className = 'cell cross-cell flex items-center justify-center bg-white/6 text-lg font-bold rounded-md';
          span.dataset.r = r; span.dataset.c = c;
          span.textContent = grid[r][c];
          span.addEventListener('click', onCellClick);
          gridEl.appendChild(span);
        }
      }
    }

    function renderWordsList(){
      wordsListEl.innerHTML = '';
      for (const p of placed) {
        const li = document.createElement('li');
        li.textContent = p.word;
        li.id = 'word-' + p.word;
        li.className = 'text-gray-200';
        wordsListEl.appendChild(li);
      }
    }

    function onCellClick(e){
      const el = e.currentTarget;
      const r = +el.dataset.r; const c = +el.dataset.c;
      // toggle selection of this cell
      const idx = selection.findIndex(s => s.r===r && s.c===c);
      if (idx >= 0) {
        // unselect from idx to end
        for (let i = selection.length-1; i>=idx; i--) selection[i].el.classList.remove('selected'), selection.pop();
      } else {
        // add
        selection.push({r,c,el});
        el.classList.add('selected');
      }
    }

    // utility to get selected string
    function getSelectedString() {
      return selection.map(s => s.el.textContent).join('');
    }
    function getSelectedCoords() {
      return selection.map(s => ({r:s.r,c:s.c}));
    }

    // check button logic
    document.getElementById('checkBtn').addEventListener('click', () => {
      const s = getSelectedString();
      const coords = getSelectedCoords();
      if (!s) { setMsg('Selecciona letras primero.'); return; }
      // check against placed words (normal or reversed)
      let matched = null;
      for (const p of placed) {
        const w = p.word;
        // build string from p.coords
        const pstr = p.coords.map(pt => grid[pt.r][pt.c]).join('');
        if (s === pstr) { matched = p; break; }
        const rev = pstr.split('').reverse().join('');
        if (s === rev) { matched = p; break; }
      }
      if (matched) {
        // mark found: mark letters as found, mark word list item
        for (const sel of selection) sel.el.classList.remove('selected'), sel.el.classList.add('found');
        document.getElementById('word-' + matched.word).style.textDecoration = 'line-through';
        foundWords.add(matched.word);
        selection = [];
        setMsg(`¡Encontraste "${matched.word}"!`);
      } else {
        setMsg('No coincide con ninguna palabra. Intenta otra vez.');
        // flash selection then clear
        for (const sel of selection) sel.el.classList.remove('selected');
        selection = [];
      }
      // win condition
      if (foundWords.size === placed.length) setMsg('¡Felicidades! Encontraste todas las palabras 🎉');
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      // clear found and selections and regenerate grid but keep words placed
      foundWords.clear();
      selection = [];
      // remove classes
      document.querySelectorAll('#grid .cell').forEach(el => el.className = 'cell cross-cell flex items-center justify-center bg-white/6 text-lg font-bold rounded-md');
      // reset word list strike
      placed.forEach(p => { const li = document.getElementById('word-'+p.word); if (li) li.style.textDecoration='none'; });
      setMsg('Juego reiniciado (mantiene la misma disposición).');
    });

    document.getElementById('revealBtn').addEventListener('click', () => {
      // reveal all words visually
      placed.forEach(p => {
        p.coords.forEach(pt => {
          const cell = document.querySelector(`#grid .cell[data-r="${pt.r}"][data-c="${pt.c}"]`);
          if (cell) cell.classList.add('revealed');
        });
        const li = document.getElementById('word-'+p.word);
        if (li) li.style.textDecoration = 'line-through';
        foundWords.add(p.word);
      });
      setMsg('Solución mostrada.');
    });

    function setMsg(t) { document.getElementById('msg').textContent = t; }

    // initial render
    renderGrid();
    renderWordsList();

    /* ---------- CRUCIGRAMA ---------- */
    // We'll build a small 9x9 grid with 4 clues (2 horizontal, 2 vertical).
    // Layout array: null = black cell, '' = empty cell
    // We'll encode positions with a simple pattern.
    const CROSS_ROWS = 9, CROSS_COLS = 9;
    const crossLayout = [
      // 9 columns each row
      ['','','','A','','','','',''],
      ['','B','','A','','','C','',''],
      ['','','','','','C','','',''],
      ['','','','','','C','','',''],
      ['','','','','','','','',''],
      ['','','D','','','','','',''],
      ['','','D','','','','','',''],
      ['','','D','','','','','',''],
      ['','','','','','','','','']
    ];
    // But easier: we'll create an explicit mapping of cells that belong to words:
    // Across 1: row 1 col 1-7 (INSTRUM -> ESTACION is 8? We'll use ESTACION(8))
    // To follow clues we set:
    // Horizontal 1 (1 H): starts r1c1 length 7 -> "TEODOL0"? better: "TEODOL0" wrong.
    // For simplicity and to match clues earlier:
    // Horizontal clues given in UI:
    // 1. Instrumento para medir ángulos (7 letras) -> "TEODOL0"? Correct word is "TEODOLITO" (9). But clue said 7 — mismatch.
    // To avoid mismatch, I'll select words that fit:
    // Let's use:
    // H1 (1): "ESTACA" (6) — not instrument. This is messy.
    // To keep consistent with the hints provided earlier in the UI, we'll actually use these answers:
    // Horizontal 1 (1): "TEODOLITO" (9) -> change clue to (9)
    // Horizontal 3 (3): "ACUEDUCTO" (9) -> corresponds to redes de agua (9)
    // Vertical 2 (2): "CURVA" (5)
    // Vertical 4 (4): "GPS" (3)
    //
    // We'll place them into a 9x9 shown grid with positions chosen below.

    // Define words and positions explicitly:
    // Each item: {word, coords:[{r,c}, ...]}
    const crossWords = [
      { id: 'H1', word: 'TEODOLITO', coords: Array.from({length:9}, (_,i)=>({r:0,c:i})) }, // row 0 cols 0..8
      { id: 'V2', word: 'CURVA', coords: Array.from({length:5}, (_,i)=>({r:i+1,c:2})) },    // col 2 rows 1..5
      { id: 'H3', word: 'ACUEDUCTO', coords: Array.from({length:9}, (_,i)=>({r:4,c:i})) }, // row 4 cols 0..8
      { id: 'V4', word: 'GPS', coords: Array.from({length:3}, (_,i)=>({r:i+2,c:6})) }       // col 6 rows 2..4
    ];

    // Build a 9x9 cell array with null for black cells
    const crossGridArr = Array.from({length:9}, () => Array.from({length:9}, () => null));
    // Mark white cells that are used in any word
    crossWords.forEach(w => {
      for (const p of w.coords) crossGridArr[p.r][p.c] = '';
    });

    // Render cross grid
    const crossGridEl = document.getElementById('crossGrid');
    function renderCrossGrid() {
      crossGridEl.innerHTML = '';
      crossGridEl.style.gridTemplateColumns = `repeat(${CROSS_COLS}, 40px)`;
      for (let r=0;r<CROSS_ROWS;r++){
        for (let c=0;c<CROSS_COLS;c++){
          const div = document.createElement('div');
          if (crossGridArr[r][c] === null) {
            div.className = 'cross-cell cross-black';
          } else {
            div.className = 'cross-cell flex items-center justify-center bg-white/6';
            const input = document.createElement('input');
            input.maxLength = 1;
            input.className = 'input-letter';
            input.dataset.r = r; input.dataset.c = c;
            input.addEventListener('input', (e)=> e.target.value = e.target.value.toUpperCase().replace(/[^A-ZÑ]/g,''));
            div.appendChild(input);
          }
          crossGridEl.appendChild(div);
        }
      }
    }

    renderCrossGrid();

    // Utility: read grid letters into map by position
    function readCrossInput() {
      const map = {};
      document.querySelectorAll('#crossGrid input').forEach(inp => {
        map[ `${inp.dataset.r},${inp.dataset.c}` ] = (inp.value || '').toUpperCase();
      });
      return map;
    }

    // Check crossword
    document.getElementById('crossCheck').addEventListener('click', () => {
      const map = readCrossInput();
      let allCorrect = true;
      let incorrectWords = [];
      for (const w of crossWords) {
        const letters = w.coords.map(p => map[`${p.r},${p.c}`] || '');
        const answer = w.word.toUpperCase().split('');
        const ok = answer.every((ch,idx) => ch === letters[idx]);
        if (!ok) {
          allCorrect = false;
          incorrectWords.push(w.id);
        }
      }
      if (allCorrect) {
        document.getElementById('crossMsg').textContent = '¡Crucigrama correcto! 🎉';
      } else {
        document.getElementById('crossMsg').textContent = 'Aún hay errores. Revisa las palabras: ' + incorrectWords.join(', ');
      }
    });

    // Reveal crossword solution
    document.getElementById('crossReveal').addEventListener('click', () => {
      // fill inputs
      document.querySelectorAll('#crossGrid input').forEach(inp => inp.value = '');
      for (const w of crossWords) {
        const letters = w.word.toUpperCase().split('');
        for (let i=0;i<w.coords.length;i++){
          const p = w.coords[i];
          const selector = `#crossGrid input[data-r="${p.r}"][data-c="${p.c}"]`;
          const inp = document.querySelector(selector);
          if (inp) inp.value = letters[i];
        }
      }
      document.getElementById('crossMsg').textContent = 'Solución mostrada.';
    });

    document.getElementById('crossReset').addEventListener('click', () => {
      document.querySelectorAll('#crossGrid input').forEach(inp => inp.value = '');
      document.getElementById('crossMsg').textContent = 'Crucigrama reiniciado.';
    });

    // OPTIONAL: keyboard navigation improvement (arrow keys)
    document.addEventListener('keydown', (e) => {
      const active = document.activeElement;
      if (active && active.tagName === 'INPUT' && active.classList.contains('input-letter')) {
        const r = parseInt(active.dataset.r), c = parseInt(active.dataset.c);
        if (e.key === 'ArrowRight') {
          focusCell(r, c+1);
          e.preventDefault();
        } else if (e.key === 'ArrowLeft') {
          focusCell(r, c-1);
          e.preventDefault();
        } else if (e.key === 'ArrowDown') {
          focusCell(r+1, c);
          e.preventDefault();
        } else if (e.key === 'ArrowUp') {
          focusCell(r-1, c);
          e.preventDefault();
        }
      }
    });

    function focusCell(r,c){
      const sel = document.querySelector(`#crossGrid input[data-r="${r}"][data-c="${c}"]`);
      if (sel) sel.focus();
    }

  </script>
</body>
</html>