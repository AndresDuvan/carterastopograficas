<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listado de Estudiantes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-6">

  <h1 class="text-3xl font-bold text-center mb-6">Listado de Estudiantes</h1>

  <!-- 游댌 Barra de b칰squeda -->
  <div class="flex justify-center mb-4">
    <input id="searchInput" type="text" placeholder="Buscar por nombre..." 
      class="border rounded-lg px-4 py-2 w-1/2 shadow focus:outline-none focus:ring-2 focus:ring-blue-400">
  </div>

  <!-- 游댳 BOT칍N PARA ABRIR EL MODAL -->
  <div class="flex justify-center mb-4">
    <button onclick="abrirModal()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
      Ver gr치fico de aprobados
    </button>
  </div>

  <!-- 游댳 TABLA -->
  <div class="overflow-x-auto">
    <table id="tablaEstudiantes" class="table-auto border-collapse border border-gray-300 w-full bg-white shadow-md rounded-lg">
      <thead>
        <tr class="bg-blue-500 text-white">
          <th class="border border-gray-300 px-4 py-2">Identificaci칩n</th>
          <th class="border border-gray-300 px-4 py-2">Nombre del Estudiante</th>
          <th class="border border-gray-300 px-4 py-2">Curso</th>
          <th class="border border-gray-300 px-4 py-2">Nota del Estudiante</th>
        </tr>
      </thead>
      <tbody>
        {% for registro in registros %}
        <tr class="hover:bg-gray-100">
          <td class="border border-gray-300 px-4 py-2">{{ registro['Identificaci칩n'] }}</td>
          <td class="border border-gray-300 px-4 py-2 nombre-estudiante">{{ registro['Nombre del Estudiante'] }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ registro['Curso'] }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ registro['Nota del Estudiante'] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- 游댳 MODAL -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96 relative">
      <button onclick="cerrarModal()" class="absolute top-2 right-2 text-gray-600 text-2xl">&times;</button>
      <h2 class="text-xl font-bold mb-4">Estudiantes Aprobados vs No Aprobados</h2>
      <canvas id="graficoAprobados"></canvas>
    </div>
  </div>

  <!-- 游댳 SCRIPT -->
  <script>
    const registros = JSON.parse('{{ registros_json | safe }}');

    // Funci칩n b칰squeda
    document.getElementById("searchInput").addEventListener("keyup", function() {
      let filtro = this.value.toLowerCase();
      let filas = document.querySelectorAll("#tablaEstudiantes tbody tr");

      filas.forEach(fila => {
        let nombre = fila.querySelector(".nombre-estudiante").textContent.toLowerCase();
        if (nombre.includes(filtro)) {
          fila.style.display = "";
        } else {
          fila.style.display = "none";
        }
      });
    });

    // Funciones gr치fico
    function contarAprobados() {
      let aprobados = 0, noAprobados = 0;
      registros.forEach(r => {
        if (r["Nota del Estudiante"] >= 3.0) {
          aprobados++;
        } else {
          noAprobados++;
        }
      });
      return { aprobados, noAprobados };
    }

    let chartInstance = null;

    function abrirModal() {
      document.getElementById("modal").classList.remove("hidden");
      const ctx = document.getElementById("graficoAprobados").getContext("2d");
      const { aprobados, noAprobados } = contarAprobados();

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Aprobados', 'No Aprobados'],
          datasets: [{
            data: [aprobados, noAprobados],
            backgroundColor: ['#4CAF50', '#F44336']
          }]
        }
      });
    }

    function cerrarModal() {
      document.getElementById("modal").classList.add("hidden");
    }
  </script>

</body>
</html>